<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>动态数据显示</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
</head>

<body>
    <div id="main" style="width: 450px; height: 230px; "></div>
    <script type="text/javascript">
        "object" != typeof ue || "object" != typeof ue.interface ? ("object" != typeof ue && (ue = {}),
            ue.interface = {}, ue.interface.broadcast = function (e, t) {
                if ("string" == typeof e) {
                    var o = [e, ""]; void 0 !== t && (o[1] = t); var n = encodeURIComponent(JSON.stringify(o));
                    "object" == typeof history && "function" == typeof history.pushState ? (history.pushState(
                        {}, "", "#" + n), history.pushState({}, "", "#" + encodeURIComponent("[]"))) :
                        (document.location.hash = n, document.location.hash = encodeURIComponent("[]"))
                }
            }) :
            function (e) {
                ue.interface = {}, ue.interface.broadcast = function (t, o) {
                    "string" == typeof t && (void 0 !== o ? e.broadcast(t, JSON.stringify(o)) :
                        e.broadcast(t, ""))
                }
            }(ue.interface), ue5 = ue.interface.broadcast;
        //WEB UI InitialEvent https://github.com/tracerinteractive/UnrealEngine/releases
        var myChart = echarts.init(document.getElementById('main'));
        const data1 = [120, 87, 145, 256, 199, 14];
        const data2 = [12, 289, 204, 34, 78, 299];
        const data3 = [203, 178, 55, 67, 290, 23];
        const data4 = [76, 58, 289, 142, 210, 99];
        const datax = ['3月', '4月', '5月', '6月', '7月', '8月'],
            option = {
                title: {
                    text: '',
                    textStyle: {
                        color: '#FFFFFF', // 设置图例文字颜色为白色
                        fontSize: 14 // 设置字体大小为14
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                legend: {
                    textStyle: {
                        color: '#FFFFFF', // 设置图例文字颜色为白色
                        fontSize: 14 // 设置字体大小为14
                    }
                },
                grid: {
                    left: '1%',
                    right: '1%',
                    bottom: '1%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: datax, // 改为类别轴
                    axisLabel: {
                        color: '#FFFFFF', // 正确设置X轴标签颜色为白色
                        fontSize: 14 // 设置字体大小为14
                    }
                },
                yAxis: {
                    type: 'value',
                    name: '(万kwh)',
                    boundaryGap: [0, 0.01], // 改为数值轴
                    nameTextStyle: {
                        color: '#FFFFFF', // 设置名称的颜色为白色
                        fontSize: 14 // 设置字体大小为14
                    },
                    axisLabel: {
                        color: '#FFFFFF', // 正确设置X轴标签颜色为白色
                        fontSize: 14 // 设置字体大小为14
                    },
                    splitLine: {
                        show: true,
                        lineStyle: {
                            type: 'dotted', // 设置分割线为点状线
                            color: 'rgb(100, 100, 100)' // 使用与轴线相同的颜色
                        }
                    }
                },
                series: [
                    {
                        name: '机组一',
                        type: 'bar',
                        data: data1,
                        itemStyle: {
                            color: {
                                type: 'linear',
                                x: 0,
                                y: 0,
                                x2: 0,
                                y2: 1,
                                colorStops: [
                                    {
                                        offset: 0,
                                        color: 'rgb(155, 234, 114)' // 0% 处的颜色
                                    },
                                    {
                                        offset: 1,
                                        color: 'rgb(126, 249, 147)' // 100% 处的颜色
                                    }
                                ],
                                global: false // 缺省为 false
                            }
                        }
                    },
                    {
                        name: '机组二',
                        type: 'bar',
                        data: data2,
                        itemStyle: {
                            color: {
                                type: 'linear',
                                x: 0,
                                y: 0,
                                x2: 0,
                                y2: 1,
                                colorStops: [
                                    {
                                        offset: 0,
                                        color: 'rgb(55, 234, 204)' // 0% 处的颜色
                                    },
                                    {
                                        offset: 1,
                                        color: 'rgb(49, 182, 88)' // 100% 处的颜色
                                    }
                                ],
                                global: false // 缺省为 false
                            }
                        }
                    },
                    {
                        name: '机组三',
                        type: 'bar',
                        data: data3,
                        itemStyle: {
                            color: {
                                type: 'linear',
                                x: 0,
                                y: 0,
                                x2: 0,
                                y2: 1,
                                colorStops: [
                                    {
                                        offset: 0,
                                        color: 'rgb(200, 218, 80)' // 0% 处的颜色
                                    },
                                    {
                                        offset: 1,
                                        color: 'rgb(233, 200, 113)' // 100% 处的颜色
                                    }
                                ],
                                global: false // 缺省为 false
                            }
                        }
                    },
                    {
                        name: '机组四',
                        type: 'bar',
                        data: data4,
                        itemStyle: {
                            color: {
                                type: 'linear',
                                x: 0,
                                y: 0,
                                x2: 0,
                                y2: 1,
                                colorStops: [
                                    {
                                        offset: 0,
                                        color: 'rgb(220, 143, 60)' // 0% 处的颜色
                                    },
                                    {
                                        offset: 1,
                                        color: 'rgb(140, 122, 113)' // 100% 处的颜色
                                    }
                                ],
                                global: false // 缺省为 false
                            }
                        }
                    }
                ]
            };


        myChart.setOption(option);
        ue.interface.ue2js1 = function (ueData) {
            ue5("js2ue", "knjw1");
            var jsonobj = JSON.parse(ueData);
            myChart.setOption(jsonobj);
            ue5("js2ue", "knjw");
        };
        ue.interface.ue2js2 = function (ueData) {
            try {
                // 第一个反馈给 UE，表示函数开始执行
                ue5("js2ue", "knjw1");

                // 将 ueData 解析为 JSON 对象
                var jsonobj = JSON.parse(ueData);

                // 假设 jsonobj 中包含 xAxis 的新 data
                if (jsonobj.xAxis && jsonobj.xAxis.data) {
                    myChart.setOption({
                        xAxis: {
                            data: jsonobj.xAxis.data  // 更新 xAxis 的 data
                        }
                    });
                }

                // 更新图表后，再次发送反馈给 UE，表示操作完成
                ue5("js2ue", "knjw");

            } catch (error) {
                console.error("Error parsing ueData or setting option:", error);
                ue5("js2ue", "error encountered");
            }
        };

        // Receive Message From UE


    </script>
</body>

</html>